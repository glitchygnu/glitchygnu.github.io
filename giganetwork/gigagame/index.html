<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Clash - The Addictive Clicker Game</title>
    <style>
        :root {
            --primary: #6e45e2;
            --secondary: #88d3ce;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --accent: #ff6b6b;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
            user-select: none;
        }
        
        body {
            background: linear-gradient(135deg, var(--dark), #16213e);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary);
        }
        
        .game-title {
            font-size: 2.5rem;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 10px rgba(110, 69, 226, 0.3);
        }
        
        .stats {
            display: flex;
            gap: 20px;
        }
        
        .stat-box {
            background: rgba(26, 26, 46, 0.7);
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid var(--primary);
            box-shadow: 0 0 15px rgba(110, 69, 226, 0.2);
        }
        
        .main-game {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .click-area {
            flex: 1;
            background: rgba(26, 26, 46, 0.5);
            border-radius: 20px;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--primary);
            box-shadow: 0 0 30px rgba(110, 69, 226, 0.3);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            min-height: 400px;
        }
        
        .click-area:active {
            transform: scale(0.98);
            box-shadow: 0 0 20px rgba(110, 69, 226, 0.5);
        }
        
        .click-area::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(110, 69, 226, 0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .click-area:hover::before {
            opacity: 1;
        }
        
        .click-target {
            width: 200px;
            height: 200px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            color: white;
            box-shadow: 0 0 30px rgba(110, 69, 226, 0.5);
            position: relative;
            transition: transform 0.1s;
            z-index: 2;
        }
        
        .click-target:active {
            transform: scale(0.95);
        }
        
        .click-target::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.8) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .click-target:active::after {
            opacity: 0.4;
        }
        
        .click-effect {
            position: absolute;
            width: 30px;
            height: 30px;
            background: white;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0.7;
            transform: scale(0);
            animation: clickAnimation 0.5s forwards;
            z-index: 1;
        }
        
        @keyframes clickAnimation {
            0% { transform: scale(0); opacity: 0.7; }
            100% { transform: scale(3); opacity: 0; }
        }
        
        .upgrades {
            width: 300px;
            background: rgba(26, 26, 46, 0.5);
            border-radius: 20px;
            padding: 20px;
            border: 2px solid var(--primary);
            box-shadow: 0 0 20px rgba(110, 69, 226, 0.2);
            overflow-y: auto;
            max-height: 600px;
        }
        
        .upgrades h2 {
            margin-bottom: 20px;
            color: var(--secondary);
            text-align: center;
            font-size: 1.5rem;
        }
        
        .upgrade-item {
            background: rgba(26, 26, 46, 0.7);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid var(--primary);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .upgrade-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(110, 69, 226, 0.3);
        }
        
        .upgrade-item.unlocked {
            border-color: var(--secondary);
        }
        
        .upgrade-item.locked {
            opacity: 0.6;
            filter: grayscale(50%);
            cursor: not-allowed;
        }
        
        .upgrade-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .upgrade-cost {
            color: var(--accent);
        }
        
        .upgrade-level {
            color: var(--secondary);
        }
        
        .achievements {
            background: rgba(26, 26, 46, 0.5);
            border-radius: 20px;
            padding: 20px;
            margin-top: 30px;
            border: 2px solid var(--primary);
            box-shadow: 0 0 20px rgba(110, 69, 226, 0.2);
        }
        
        .achievements h2 {
            margin-bottom: 20px;
            color: var(--secondary);
            text-align: center;
            font-size: 1.5rem;
        }
        
        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .achievement {
            background: rgba(26, 26, 46, 0.7);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid var(--primary);
            transition: all 0.3s;
        }
        
        .achievement.unlocked {
            border-color: gold;
            background: rgba(26, 26, 46, 0.9);
        }
        
        .achievement.unlocked .achievement-title {
            color: gold;
        }
        
        .achievement-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--light);
        }
        
        .achievement-desc {
            font-size: 0.9rem;
            color: #aaa;
        }
        
        .achievement-progress {
            height: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .achievement-progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s;
        }
        
        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        
        .particle {
            position: absolute;
            background: white;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
        }
        
        .combo-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5rem;
            font-weight: bold;
            color: var(--accent);
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.7);
            opacity: 0;
            pointer-events: none;
            z-index: 10;
            animation: comboFade 1s forwards;
        }
        
        @keyframes comboFade {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }
        
        .critical-hit {
            animation: criticalHit 0.3s forwards;
        }
        
        @keyframes criticalHit {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        
        .prestige-button {
            background: linear-gradient(135deg, gold, #ffd700);
            color: #333;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            transition: all 0.3s;
        }
        
        .prestige-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.7);
        }
        
        .prestige-button:active {
            transform: translateY(1px);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(26, 26, 46, 0.9);
            border-left: 5px solid var(--accent);
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            transform: translateX(150%);
            transition: transform 0.3s;
            z-index: 100;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification-title {
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 5px;
        }
        
        @media (max-width: 768px) {
            .main-game {
                flex-direction: column;
            }
            
            .upgrades {
                width: 100%;
            }
            
            .click-target {
                width: 150px;
                height: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 class="game-title">COSMIC CLASH</h1>
            <div class="stats">
                <div class="stat-box">
                    <div>Energy: <span id="energy">0</span></div>
                </div>
                <div class="stat-box">
                    <div>EPS: <span id="eps">0</span></div>
                </div>
                <div class="stat-box">
                    <div>EPC: <span id="epc">1</span></div>
                </div>
            </div>
        </header>
        
        <div class="main-game">
            <div class="click-area" id="clickArea">
                <div class="particles" id="particles"></div>
                <div class="click-target" id="clickTarget">
                    TAP!
                </div>
            </div>
            
            <div class="upgrades">
                <h2>UPGRADES</h2>
                <div id="upgradesContainer">
                    <!-- Upgrades will be added here dynamically -->
                </div>
                
                <button class="prestige-button" id="prestigeButton" style="display: none;">
                    PRESTIGE (Reset for bonuses!)
                </button>
            </div>
        </div>
        
        <div class="achievements">
            <h2>ACHIEVEMENTS</h2>
            <div class="achievement-grid" id="achievementsContainer">
                <!-- Achievements will be added here dynamically -->
            </div>
        </div>
    </div>
    
    <div class="combo-display" id="comboDisplay"></div>
    
    <div class="notification" id="notification">
        <div class="notification-title" id="notificationTitle">Achievement Unlocked!</div>
        <div class="notification-message" id="notificationMessage">You've unlocked an achievement!</div>
    </div>
    
    <script>
        // Game State
        const game = {
            energy: 0,
            energyPerClick: 1,
            energyPerSecond: 0,
            totalClicks: 0,
            totalEnergy: 0,
            upgrades: [],
            achievements: [],
            combo: 0,
            lastClickTime: 0,
            comboTimeout: null,
            prestigePoints: 0,
            highestEnergy: 0,
            particles: [],
            clickEffects: [],
            version: "1.0.0",
            saveVersion: "1.0.0"
        };
        
        // Upgrades Data
        const upgradesData = [
            { id: 1, name: "Solar Panel", description: "Generate 0.2 energy per second", baseCost: 10, baseValue: 0.2, scaling: 1.15, maxLevel: 0, unlockAt: 0 },
            { id: 2, name: "Fusion Reactor", description: "Generate 1 energy per second", baseCost: 100, baseValue: 1, scaling: 1.15, maxLevel: 0, unlockAt: 50 },
            { id: 3, name: "Quantum Singularity", description: "Generate 5 energy per second", baseCost: 1000, baseValue: 5, scaling: 1.15, maxLevel: 0, unlockAt: 500 },
            { id: 4, name: "Click Amplifier", description: "+1 energy per click", baseCost: 50, baseValue: 1, scaling: 1.2, maxLevel: 0, unlockAt: 20 },
            { id: 5, name: "Click Multiplier", description: "Multiply click power by 1.5x", baseCost: 200, baseValue: 1.5, scaling: 1.3, maxLevel: 0, unlockAt: 100 },
            { id: 6, name: "Auto-Clicker", description: "Automatically click once per second", baseCost: 500, baseValue: 1, scaling: 1.25, maxLevel: 0, unlockAt: 300 },
            { id: 7, name: "Critical Chance", description: "10% chance for 5x energy", baseCost: 1000, baseValue: 0.1, scaling: 1.4, maxLevel: 0, unlockAt: 800 },
            { id: 8, name: "Combo Bonus", description: "Increase combo multiplier", baseCost: 1500, baseValue: 0.2, scaling: 1.5, maxLevel: 0, unlockAt: 1200 }
        ];
        
        // Achievements Data
        const achievementsData = [
            { id: 1, name: "First Click", description: "Click for the first time", goal: 1, current: 0, type: "clicks", reward: 10, unlocked: false },
            { id: 2, name: "Energy Novice", description: "Reach 100 energy", goal: 100, current: 0, type: "energy", reward: 50, unlocked: false },
            { id: 3, name: "Click Master", description: "Perform 500 clicks", goal: 500, current: 0, type: "clicks", reward: 100, unlocked: false },
            { id: 4, name: "Energy Expert", description: "Reach 1,000 energy", goal: 1000, current: 0, type: "energy", reward: 200, unlocked: false },
            { id: 5, name: "Upgrade Enthusiast", description: "Buy 10 upgrades", goal: 10, current: 0, type: "upgrades", reward: 150, unlocked: false },
            { id: 6, name: "Combo Starter", description: "Reach a 5x combo", goal: 5, current: 0, type: "combo", reward: 75, unlocked: false },
            { id: 7, name: "Energy Master", description: "Reach 10,000 energy", goal: 10000, current: 0, type: "energy", reward: 500, unlocked: false },
            { id: 8, name: "Click Legend", description: "Perform 5,000 clicks", goal: 5000, current: 0, type: "clicks", reward: 1000, unlocked: false },
            { id: 9, name: "Critical Success", description: "Get 50 critical hits", goal: 50, current: 0, type: "criticals", reward: 300, unlocked: false },
            { id: 10, name: "Prestige Seeker", description: "Prestige once", goal: 1, current: 0, type: "prestige", reward: 1000, unlocked: false }
        ];
        
        // DOM Elements
        const energyDisplay = document.getElementById('energy');
        const epsDisplay = document.getElementById('eps');
        const epcDisplay = document.getElementById('epc');
        const clickArea = document.getElementById('clickArea');
        const clickTarget = document.getElementById('clickTarget');
        const upgradesContainer = document.getElementById('upgradesContainer');
        const achievementsContainer = document.getElementById('achievementsContainer');
        const comboDisplay = document.getElementById('comboDisplay');
        const notification = document.getElementById('notification');
        const notificationTitle = document.getElementById('notificationTitle');
        const notificationMessage = document.getElementById('notificationMessage');
        const prestigeButton = document.getElementById('prestigeButton');
        const particlesContainer = document.getElementById('particles');
        
        // Initialize the game
        function initGame() {
            loadGame();
            setupUpgrades();
            setupAchievements();
            render();
            
            // Game loop
            setInterval(gameLoop, 1000);
            
            // Animation loop
            requestAnimationFrame(animationLoop);
        }
        
        // Game loop
        function gameLoop() {
            // Generate energy from passive sources
            generatePassiveEnergy();
            
            // Update displays
            updateDisplays();
            
            // Check for achievements
            checkAchievements();
            
            // Auto-clicker functionality
            autoClick();
            
            // Save game periodically
            if (game.totalClicks % 10 === 0) {
                saveGame();
            }
            
            // Show prestige button if conditions are met
            if (game.energy >= 10000 && game.prestigePoints === 0) {
                prestigeButton.style.display = 'block';
            }
        }
        
        // Animation loop
        function animationLoop() {
            updateParticles();
            updateClickEffects();
            requestAnimationFrame(animationLoop);
        }
        
        // Setup upgrades
        function setupUpgrades() {
            upgradesContainer.innerHTML = '';
            game.upgrades = JSON.parse(JSON.stringify(upgradesData));
            
            game.upgrades.forEach(upgrade => {
                const upgradeElement = document.createElement('div');
                upgradeElement.className = `upgrade-item ${game.energy >= upgrade.unlockAt ? '' : 'locked'}`;
                upgradeElement.innerHTML = `
                    <div class="upgrade-header">
                        <span class="upgrade-name">${upgrade.name}</span>
                        <span class="upgrade-cost">Cost: ${Math.floor(upgrade.baseCost * Math.pow(upgrade.scaling, upgrade.maxLevel))}</span>
                    </div>
                    <div class="upgrade-description">${upgrade.description}</div>
                    <div class="upgrade-level">Level: ${upgrade.maxLevel}</div>
                `;
                
                if (game.energy >= upgrade.unlockAt) {
                    upgradeElement.addEventListener('click', () => buyUpgrade(upgrade.id));
                }
                
                upgradesContainer.appendChild(upgradeElement);
                upgrade.element = upgradeElement;
            });
        }
        
        // Setup achievements
        function setupAchievements() {
            achievementsContainer.innerHTML = '';
            game.achievements = JSON.parse(JSON.stringify(achievementsData));
            
            game.achievements.forEach(achievement => {
                const achievementElement = document.createElement('div');
                achievementElement.className = `achievement ${achievement.unlocked ? 'unlocked' : ''}`;
                
                const progressPercent = (achievement.current / achievement.goal) * 100;
                
                achievementElement.innerHTML = `
                    <div class="achievement-title">${achievement.name}</div>
                    <div class="achievement-desc">${achievement.description}</div>
                    ${achievement.unlocked ? 
                        '<div class="achievement-reward">Reward: +' + achievement.reward + ' energy</div>' : 
                        `<div class="achievement-progress">
                            <div class="achievement-progress-bar" style="width: ${progressPercent}%"></div>
                        </div>`
                    }
                `;
                
                achievementsContainer.appendChild(achievementElement);
                achievement.element = achievementElement;
            });
        }
        
        // Buy upgrade
        function buyUpgrade(upgradeId) {
            const upgrade = game.upgrades.find(u => u.id === upgradeId);
            if (!upgrade) return;
            
            const cost = Math.floor(upgrade.baseCost * Math.pow(upgrade.scaling, upgrade.maxLevel));
            
            if (game.energy >= cost) {
                game.energy -= cost;
                upgrade.maxLevel++;
                
                // Apply upgrade effect
                switch (upgrade.id) {
                    case 1:
                    case 2:
                    case 3:
                        game.energyPerSecond += upgrade.baseValue;
                        break;
                    case 4:
                        game.energyPerClick += upgrade.baseValue;
                        break;
                    case 5:
                        game.energyPerClick *= upgrade.baseValue;
                        break;
                    case 7:
                        // Critical chance is handled in the click function
                        break;
                    case 8:
                        // Combo bonus is handled in the click function
                        break;
                }
                
                // Update upgrade display
                updateUpgradeDisplay(upgrade);
                updateDisplays();
                
                // Check for upgrade-related achievements
                checkAchievements();
                
                // Visual feedback
                createParticles(20, upgrade.element.getBoundingClientRect());
            }
        }
        
        // Update upgrade display
        function updateUpgradeDisplay(upgrade) {
            const cost = Math.floor(upgrade.baseCost * Math.pow(upgrade.scaling, upgrade.maxLevel));
            
            upgrade.element.innerHTML = `
                <div class="upgrade-header">
                    <span class="upgrade-name">${upgrade.name}</span>
                    <span class="upgrade-cost">Cost: ${cost}</span>
                </div>
                <div class="upgrade-description">${upgrade.description}</div>
                <div class="upgrade-level">Level: ${upgrade.maxLevel}</div>
            `;
            
            // Check if player can afford
            if (game.energy < cost) {
                upgrade.element.classList.add('locked');
            } else {
                upgrade.element.classList.remove('locked');
            }
        }
        
        // Handle click
        function handleClick(event) {
            // Check if click is on the target or area
            const isTargetClick = event.target === clickTarget || event.target.closest('#clickTarget');
            
            // Calculate click position for effects
            const rect = clickArea.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            // Add click effect
            addClickEffect(x, y);
            
            // Calculate energy gain
            let energyGain = game.energyPerClick;
            
            // Combo system
            const now = Date.now();
            const timeDiff = now - game.lastClickTime;
            
            if (timeDiff < 500) { // Half second window for combos
                game.combo++;
                clearTimeout(game.comboTimeout);
                
                // Show combo display
                if (game.combo > 1) {
                    comboDisplay.textContent = `${game.combo}x COMBO!`;
                    comboDisplay.style.opacity = '1';
                    
                    // Apply combo bonus if upgrade is purchased
                    const comboUpgrade = game.upgrades.find(u => u.id === 8);
                    if (comboUpgrade && comboUpgrade.maxLevel > 0) {
                        const comboMultiplier = 1 + (comboUpgrade.maxLevel * comboUpgrade.baseValue);
                        energyGain *= comboMultiplier;
                    }
                    
                    // Animate combo display
                    setTimeout(() => {
                        comboDisplay.style.opacity = '0';
                    }, 500);
                }
            } else {
                game.combo = 0;
            }
            
            game.lastClickTime = now;
            game.comboTimeout = setTimeout(() => {
                game.combo = 0;
            }, 500);
            
            // Critical hit chance
            const criticalUpgrade = game.upgrades.find(u => u.id === 7);
            let isCritical = false;
            
            if (criticalUpgrade && criticalUpgrade.maxLevel > 0) {
                const criticalChance = criticalUpgrade.baseValue * criticalUpgrade.maxLevel;
                if (Math.random() < criticalChance) {
                    energyGain *= 5;
                    isCritical = true;
                    game.achievements.find(a => a.id === 9).current++;
                    
                    // Visual feedback for critical
                    clickTarget.classList.add('critical-hit');
                    setTimeout(() => {
                        clickTarget.classList.remove('critical-hit');
                    }, 300);
                }
            }
            
            // Add energy
            game.energy += energyGain;
            game.totalClicks++;
            game.totalEnergy += energyGain;
            
            if (game.energy > game.highestEnergy) {
                game.highestEnergy = game.energy;
            }
            
            // Update displays
            updateDisplays();
            
            // Visual feedback
            if (isTargetClick) {
                clickTarget.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    clickTarget.style.transform = 'scale(1)';
                }, 100);
            }
            
            // Add particles for more satisfying feedback
            createParticles(isCritical ? 30 : 15, { left: x, top: y, width: 10, height: 10 });
            
            // Check achievements
            checkAchievements();
        }
        
        // Generate passive energy
        function generatePassiveEnergy() {
            game.energy += game.energyPerSecond;
            game.totalEnergy += game.energyPerSecond;
            
            if (game.energy > game.highestEnergy) {
                game.highestEnergy = game.energy;
            }
        }
        
        // Auto-clicker functionality
        function autoClick() {
            const autoClickerUpgrade = game.upgrades.find(u => u.id === 6);
            if (autoClickerUpgrade && autoClickerUpgrade.maxLevel > 0) {
                const clicks = autoClickerUpgrade.maxLevel * autoClickerUpgrade.baseValue;
                for (let i = 0; i < clicks; i++) {
                    // Simulate a click with a slight delay to prevent freezing
                    setTimeout(() => {
                        const rect = clickArea.getBoundingClientRect();
                        const x = rect.width / 2;
                        const y = rect.height / 2;
                        
                        // Add click effect at center
                        addClickEffect(x, y);
                        
                        // Add energy
                        game.energy += game.energyPerClick;
                        game.totalClicks++;
                        game.totalEnergy += game.energyPerClick;
                        
                        if (game.energy > game.highestEnergy) {
                            game.highestEnergy = game.energy;
                        }
                        
                        // Update displays
                        updateDisplays();
                        
                        // Check achievements
                        checkAchievements();
                    }, i * 50);
                }
            }
        }
        
        // Check achievements
        function checkAchievements() {
            let unlockedAny = false;
            
            game.achievements.forEach(achievement => {
                if (achievement.unlocked) return;
                
                // Update current progress based on type
                switch (achievement.type) {
                    case 'clicks':
                        achievement.current = game.totalClicks;
                        break;
                    case 'energy':
                        achievement.current = game.energy;
                        break;
                    case 'upgrades':
                        achievement.current = game.upgrades.reduce((sum, u) => sum + u.maxLevel, 0);
                        break;
                    case 'combo':
                        if (game.combo > achievement.current) {
                            achievement.current = game.combo;
                        }
                        break;
                    case 'criticals':
                        // Already updated in click handler
                        break;
                    case 'prestige':
                        // Handled in prestige function
                        break;
                }
                
                // Check if achievement is unlocked
                if (achievement.current >= achievement.goal) {
                    achievement.unlocked = true;
                    unlockedAny = true;
                    
                    // Apply reward
                    game.energy += achievement.reward;
                    
                    // Show notification
                    showNotification(achievement.name, `You earned ${achievement.reward} energy!`);
                    
                    // Update achievement display
                    updateAchievementDisplay(achievement);
                } else {
                    // Update progress bar
                    const progressBar = achievement.element.querySelector('.achievement-progress-bar');
                    if (progressBar) {
                        const progressPercent = (achievement.current / achievement.goal) * 100;
                        progressBar.style.width = `${progressPercent}%`;
                    }
                }
            });
            
            if (unlockedAny) {
                updateDisplays();
            }
        }
        
        // Update achievement display
        function updateAchievementDisplay(achievement) {
            achievement.element.classList.add('unlocked');
            achievement.element.innerHTML = `
                <div class="achievement-title">${achievement.name}</div>
                <div class="achievement-desc">${achievement.description}</div>
                <div class="achievement-reward">Reward: +${achievement.reward} energy</div>
            `;
        }
        
        // Show notification
        function showNotification(title, message) {
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Update displays
        function updateDisplays() {
            energyDisplay.textContent = Math.floor(game.energy).toLocaleString();
            epsDisplay.textContent = game.energyPerSecond.toFixed(1);
            epcDisplay.textContent = game.energyPerClick.toFixed(1);
            
            // Update upgrade affordances
            game.upgrades.forEach(upgrade => {
                const cost = Math.floor(upgrade.baseCost * Math.pow(upgrade.scaling, upgrade.maxLevel));
                if (game.energy >= cost && game.energy >= upgrade.unlockAt) {
                    upgrade.element.classList.remove('locked');
                } else {
                    upgrade.element.classList.add('locked');
                }
            });
        }
        
        // Render the game
        function render() {
            updateDisplays();
        }
        
        // Add click effect
        function addClickEffect(x, y) {
            game.clickEffects.push({
                x,
                y,
                size: Math.random() * 10 + 5,
                life: 1,
                speedX: (Math.random() - 0.5) * 10,
                speedY: (Math.random() - 0.5) * 10,
                alpha: 1
            });
        }
        
        // Update click effects
        function updateClickEffects() {
            const effectsToKeep = [];
            
            game.clickEffects.forEach(effect => {
                effect.x += effect.speedX;
                effect.y += effect.speedY;
                effect.life -= 0.02;
                effect.alpha = effect.life;
                
                if (effect.life > 0) {
                    effectsToKeep.push(effect);
                }
            });
            
            game.clickEffects = effectsToKeep;
        }
        
        // Create particles
        function createParticles(count, rect) {
            for (let i = 0; i < count; i++) {
                game.particles.push({
                    x: rect.left + rect.width / 2,
                    y: rect.top + rect.height / 2,
                    size: Math.random() * 5 + 2,
                    color: `hsl(${Math.random() * 60 + 200}, 80%, 60%)`,
                    speedX: (Math.random() - 0.5) * 10,
                    speedY: (Math.random() - 0.5) * 10,
                    life: 1
                });
            }
        }
        
        // Update particles
        function updateParticles() {
            particlesContainer.innerHTML = '';
            
            const particlesToKeep = [];
            
            game.particles.forEach(particle => {
                particle.x += particle.speedX;
                particle.y += particle.speedY;
                particle.life -= 0.01;
                
                if (particle.life > 0) {
                    particlesToKeep.push(particle);
                    
                    const particleElement = document.createElement('div');
                    particleElement.className = 'particle';
                    particleElement.style.left = `${particle.x}px`;
                    particleElement.style.top = `${particle.y}px`;
                    particleElement.style.width = `${particle.size}px`;
                    particleElement.style.height = `${particle.size}px`;
                    particleElement.style.backgroundColor = particle.color;
                    particleElement.style.opacity = particle.life;
                    
                    particlesContainer.appendChild(particleElement);
                }
            });
            
            game.particles = particlesToKeep;
        }
        
        // Prestige function
        function prestige() {
            if (game.energy < 10000) return;
            
            // Calculate prestige points (1% of highest energy)
            const points = Math.floor(game.highestEnergy / 100);
            game.prestigePoints += points;
            
            // Reset game state but keep prestige points
            const oldPrestige = game.prestigePoints;
            Object.assign(game, {
                energy: 0,
                energyPerClick: 1 + (oldPrestige * 0.1), // Bonus based on prestige points
                energyPerSecond: 0,
                totalClicks: 0,
                totalEnergy: 0,
                combo: 0,
                lastClickTime: 0,
                highestEnergy: 0,
                upgrades: JSON.parse(JSON.stringify(upgradesData)),
                achievements: JSON.parse(JSON.stringify(achievementsData))
            });
            game.prestigePoints = oldPrestige;
            
            // Update achievement for prestige
            game.achievements.find(a => a.id === 10).current = 1;
            game.achievements.find(a => a.id === 10).unlocked = true;
            
            // Show notification
            showNotification("Prestige!", `You gained ${points} prestige points!`);
            
            // Reinitialize game
            setupUpgrades();
            setupAchievements();
            updateDisplays();
            
            // Hide prestige button until conditions are met again
            prestigeButton.style.display = 'none';
            
            // Save game
            saveGame();
        }
        
        // Save game
        function saveGame() {
            const saveData = {
                version: game.version,
                energy: game.energy,
                energyPerClick: game.energyPerClick,
                energyPerSecond: game.energyPerSecond,
                totalClicks: game.totalClicks,
                totalEnergy: game.totalEnergy,
                upgrades: game.upgrades,
                achievements: game.achievements,
                prestigePoints: game.prestigePoints,
                highestEnergy: game.highestEnergy
            };
            
            localStorage.setItem('cosmicClashSave', JSON.stringify(saveData));
        }
        
        // Load game
        function loadGame() {
            const saveData = JSON.parse(localStorage.getItem('cosmicClashSave'));
            if (!saveData) return;
            
            // Check save version for compatibility
            if (saveData.version !== game.version) {
                console.log('Save version mismatch, starting fresh');
                return;
            }
            
            // Load basic stats
            game.energy = saveData.energy || 0;
            game.energyPerClick = saveData.energyPerClick || 1;
            game.energyPerSecond = saveData.energyPerSecond || 0;
            game.totalClicks = saveData.totalClicks || 0;
            game.totalEnergy = saveData.totalEnergy || 0;
            game.prestigePoints = saveData.prestigePoints || 0;
            game.highestEnergy = saveData.highestEnergy || 0;
            
            // Load upgrades
            if (saveData.upgrades) {
                game.upgrades = saveData.upgrades.map(savedUpgrade => {
                    const baseUpgrade = upgradesData.find(u => u.id === savedUpgrade.id);
                    return { ...baseUpgrade, ...savedUpgrade };
                });
            }
            
            // Load achievements
            if (saveData.achievements) {
                game.achievements = saveData.achievements.map(savedAchievement => {
                    const baseAchievement = achievementsData.find(a => a.id === savedAchievement.id);
                    return { ...baseAchievement, ...savedAchievement };
                });
            }
        }
        
        // Event Listeners
        clickArea.addEventListener('click', handleClick);
        prestigeButton.addEventListener('click', prestige);
        
        // Start the game
        initGame();
    </script>
</body>
</html>
